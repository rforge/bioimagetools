image.plot(class[,,15])
image.plot(ifelse(xmask[,,15]==0,NA,xmask[,,15],add=TRUE)
)
image.plot(ifelse(xmask[,,15]==0,NA,xmask[,,15]),add=TRUE)
image.plot(class[,,25])
image.plot(ifelse(xmask[,,25]==0,NA,xmask[,,25]),add=TRUE)
file
prot<-readTIF(paste("green/",file,sep=""))
image.plot(prot[,,15])
image.plot(ifelse(xmask[,,25]==0,NA,xmask[,,25]),add=TRUE)
image.plot(ifelse(xmask[,,15]==0,NA,xmask[,,15]),add=TRUE)
image.plot(prot[,,10])
image.plot(ifelse(xmask[,,10]==0,NA,xmask[,,10]),add=TRUE)
image.plot(t(prot[,,10])
)
image.plot(ifelse(xmask[,,10]==0,NA,xmask[,,10]),add=TRUE)
image.plot(t(class[,,10])
)
image.plot(ifelse(xmask[,,10]==0,NA,xmask[,,10]),add=TRUE)
source('~/bioimg/software/bioimagetools/pkg/nucim/test/xi_mask.R')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
file
mask<-readTIF(paste("dapimask/",file,sep=""))
prot<-readTIF(paste("green/",file,sep=""))
image(prot[,,20])
image(prot[,,15])
image(prot.mask[,,15])
image(mask[,,15])
image(prot.mask[,,15])
image(mask[,,15])
image(prot.mask[,,15])
mask<-readTIF(paste0("dapimask/",file))
xmask<-readTIF(paste0("x_mask/",file))
xmask<-round(xmask)
xmask<-bwlabel3d(xmask,silent=TRUE)
class<-readTIF(paste0("class7/",file))
class<-round(class*7)
image(class[,,15])
image.plot(ifelse(xmask[,,20]==0,NA,xmask[,,20]),add=TRUE)
image.plot(class[,,15])
image.plot(ifelse(xmask[,,15]==0,NA,xmask[,,15]),add=TRUE)
image(ifelse(mask==1,NA,0),add=TRUE)
image(ifelse(mask[,,15]==1,NA,0),add=TRUE,col="white")
image.plot(class[,,15],col=grey(seq(0,1,by=.01)))
image.plot(ifelse(xmask[,,15]==0,NA,xmask[,,15]),add=TRUE)
image(ifelse(mask[,,15]==1,NA,0),add=TRUE,col="white")
image(prot[,,15])
image(ifelse(mask[,,15]==1,NA,0),add=TRUE,col="white")
image.plot(ifelse(xmask[,,15]==0,NA,xmask[,,15]),add=TRUE)
image.plot(ifelse(prot.mask[,,15]==0,NA,prot.mask[,,15]),add=TRUE)
writeTIF(prot.mask,file=paste0("x_mask/",file),bits.per.sample=8L)
pm<-readTIF(prot.mask,file=paste0("x_mask/",file),bits.per.sample=8L)
writeTIF(prot.mask,file=paste0("x_mask/",file),bps=8L)
pm<-readTIF(prot.mask,file=paste0("x_mask/",file))
range(pm-prot.mask)
source('~/bioimg/software/bioimagetools/pkg/nucim/test/xi_mask.R')
source('~/bioimg/software/bioimagetools/pkg/nucim/test/x_classes.R')
files
file<-files[3]
mask<-readTIF(paste0("dapimask/",file))
xmask<-readTIF(paste0("x_mask/",file))
xmask<-round(xmask)
xmask<-bwlabel3d(xmask,silent=TRUE)
class<-readTIF(paste0("class7/",file))
class<-round(class*7)
png(paste0("x_results/",file,".png"))
par(pty="s")
image.plot(class[,,20],col=grey(seq(0,1,by=.01)))
image.plot(ifelse(xmask[,,20]==0,NA,xmask[,,20]),add=TRUE)
dev.off()
png(paste0("x_results/",file,".png"))
par(pty="s")
image.plot(class[,,30],col=grey(seq(0,1,by=.01)))
image.plot(ifelse(xmask[,,30]==0,NA,xmask[,,30]),add=TRUE)
dev.off()
image.plot(class[,,30],col=grey(seq(0,1,by=.01)))
image.plot(ifelse(apply(xmask,1:2,max)==0,NA,xmask[,,30]),add=TRUE)
image.plot(ifelse(apply(xmask,1:2,max)==0,NA,apply(xmask,1:2,max)),add=TRUE)
image.plot(class[,,30],col=grey(seq(0,1,by=.01)))
xm<-apply(xmask,1:2,max)*mask
image.plot(ifelse(xm==0,NA,xm),add=TRUE)
xm<-apply(xmask*mask,1:2,max)
image.plot(ifelse(xm==0,NA,xm),add=TRUE)
image.plot(apply(class,1:2,mean),col=grey(seq(0,1,by=.01)))
xm<-apply(xmask*mask,1:2,max)
image.plot(ifelse(xm==0,NA,xm),add=TRUE)
setwd("/home/schmid/projects/marion/C2C12Xpaint")
cx<-read.table("x_results/class_x.txt")
ca<-read.table("x_results/class_all.txt")
dim(cx)
summary(cx)
for (i in 1:23)
if (cx[i,3]=="xi")barplot(cx[i,4:10])
if (cx[i,3]=="xi")barplot(as.vector(cx[i,4:10]))
as.vector(cx[i, 4:10])
c(cx[i, 4:10])
as.numeric(cx[i, 4:10])
if (cx[i,3]=="xi")barplot(as.numeric(cx[i,4:10]))
summary(ca)
summary(cx)
dim(ca)
ca<-read.table("x_results/class_all.txt")
par(mfrow=c(2,3))
for (i in 1:5)
barplot(as.numeric(cx[i,3:9]))
par(mfrow=c(2,3))
for (i in 1:23)
if (cx[i,3]=="xi")barplot(as.numeric(cx[i,4:10]))
par(mfrow=c(2,3))
for (i in 1:23)
if (cx[i,3]=="xa")barplot(as.numeric(cx[i,4:10]))
if (cx[i,3]=="xi")barplot(as.numeric(cx[i,4:10]),main="xi")
par(mfrow=c(2,3))
for (i in 1:23)
if (cx[i,3]=="xi")barplot(as.numeric(cx[i,4:10]),main="xi")
par(mfrow=c(2,3))
for (i in 1:23)
if (cx[i,3]=="xa")barplot(as.numeric(cx[i,4:10]),main="xa")
par(mfrow=c(2,3))
for (i in 1:23)
if (cx[i,3]=="na")barplot(as.numeric(cx[i,4:10]),main="na")
xi<-apply(as.numeric(cx[cx[,3]=="xi",4:10]),1,median)
cx[, 3] == "xi"
as.numeric(cx[cx[,3]=="xi",4:10])
cx[cx[,3]=="xi",4:10]
xi<-apply(as.matrix(cx[cx[,3]=="xi",4:10]),1,median)
xi
xi<-apply(as.matrix(cx[cx[,3]=="xi",4:10]),2,sum)
xi<-apply(as.matrix(cx[cx[,3]=="xi",4:10]),2,sum)
xa<-apply(as.matrix(cx[cx[,3]=="xa",4:10]),2,sum)
na<-apply(as.matrix(cx[cx[,3]=="na",4:10]),2,sum)
all<-apply(as.matrix(ca[,3:9]),2,sum)
ca[,3:9]
dim(ca)
ca
all<-apply(as.matrix(ca[,2:8]),2,sum)
barplot(all)
barplot(all)
dev.off()
dev.off()
dev.off()
dev.off()
barplot(all)
barplot(all/sum(all))
barplot(all/sum(all),axes=FALSE)
barplot(all/sum(all),axes=FALSE)
axis(1,at=1:8,labels=1:7,tick=FALSE)
axis(2,ls=2)
axis(1,at=1:7,labels=1:7,tick=FALSE)
barplot(all/sum(all),axes=FALSE)
barplot(all/sum(all),axes=FALSE,xlab="")
?barplot
barplot(all/sum(all),axes=FALSE,xlab="",legend.text=1:7)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,xlab="",legend.text=1:7)
barplot(all/sum(all),axes=FALSE,xlab="")
axis(1,at=1:7,labels=1:7,tick=FALSE)
axis(2,ls=2)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,xlab="")
axis(1,at=1:7,labels=1:7,tick=FALSE)
axis(1)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,xlab="")
axis(2,ls=2)
axis(2,la=2)
?axis
barplot(all/sum(all),axes=FALSE)
axis(2,las=2)
box()
barplot(xi/sum(xi),add=TRUE,col="blue")
barplot(xi/sum(xi),add=TRUE,col="blue",density=1)
names(all)=1:7
barplot(all/sum(all),axes=FALSE)
axis(2,las=2)
barplot(xi/sum(xi),add=TRUE,col="blue",density=1)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=1)
barplot(all/sum(all),axes=FALSE)
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=1)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=1,axes=FALSE)
barplot(xi/sum(xi),add=TRUE,col="blue",density=10,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=10,axes=FALSE)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
barplot(na/sum(na),add=TRUE,col="black",density=20,axes=FALSE,angle=90)
summary(ca)
par(mfrow=c(2,3))
for (i in 1:6)
barplot(as.numeric(cx[i,3:9]))
summary(cx)
par(mfrow=c(2,3))
for (i in 1:23)
if (cx[i,3]=="xi")barplot(as.numeric(cx[i,4:10]),main="xi")
par(mfrow=c(2,3))
for (i in 1:23)
if (cx[i,3]=="xa")barplot(as.numeric(cx[i,4:10]),main="xa")
xi<-apply(as.matrix(cx[cx[,3]=="xi",4:10]),2,median)
xa<-apply(as.matrix(cx[cx[,3]=="xa",4:10]),2,median)
na<-apply(as.matrix(cx[cx[,3]=="na",4:10]),2,median)
all<-apply(as.matrix(ca[,2:8]),2,median)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
xi<-apply(as.matrix(cx[cx[,3]=="xi",4:10]),2,sum)
xa<-apply(as.matrix(cx[cx[,3]=="xa",4:10]),2,sum)
na<-apply(as.matrix(cx[cx[,3]=="na",4:10]),2,sum)
all<-apply(as.matrix(ca[,2:8]),2,sum)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
xi<-apply(as.matrix(cx[cx[,3]=="xi",4:10]),2,mean)
xa<-apply(as.matrix(cx[cx[,3]=="xa",4:10]),2,mean)
na<-apply(as.matrix(cx[cx[,3]=="na",4:10]),2,mean)
all<-apply(as.matrix(ca[,2:8]),2,mean)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
barplot(na/sum(na),add=TRUE,col="black",density=20,axes=FALSE,angle=90)
cxm<-as.matrix(cx[,4:10])
for (i in 1:23)
cxm[i,]<-cxm[i,]/sum(cxm[i,])
cam<-as.matrix(ca[,2:8])
for (i in 1:6)
cam[i,]<-cam[i,]/sum(cam[i,])
cxm<-as.matrix(cx[,4:10])
for (i in 1:23)
cxm[i,]<-cxm[i,]/sum(cxm[i,])
cam<-as.matrix(ca[,2:8])
for (i in 1:6)
cam[i,]<-cam[i,]/sum(cam[i,])
xi<-apply(cxm[cx[,3]=="xi",],2,mean)
xa<-apply(cxm[cx[,3]=="xa",],2,mean)
na<-apply(cxm[cx[,3]=="na",],2,mean)
all<-apply(cam,2,mean)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
barplot(na/sum(na),add=TRUE,col="black",density=20,axes=FALSE,angle=90)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
#barplot(na/sum(na),add=TRUE,col="black",density=20,axes=FALSE,angle=90)
xi<-apply(cxm[cx[,3]=="xi",],2,median)
xa<-apply(cxm[cx[,3]=="xa",],2,median)
na<-apply(cxm[cx[,3]=="na",],2,median)
all<-apply(cam,2,median)
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
#barplot(na/sum(na),add=TRUE,col="black",density=20,axes=FALSE,angle=90)
png("x_result.png")
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
#barplot(na/sum(na),add=TRUE,col="black",density=20,axes=FALSE,angle=90)
dev.off()
xi<-apply(cxm[cx[,3]=="xi",],2,mean)
xa<-apply(cxm[cx[,3]=="xa",],2,mean)
na<-apply(cxm[cx[,3]=="na",],2,mean)
all<-apply(cam,2,mean)
png("x_result.png")
names(all)=1:7
barplot(all/sum(all),axes=FALSE,ylim=c(0,.5))
axis(2,las=2)
names(xi)<-names(xa)<-names(na)<-""
barplot(xi/sum(xi),add=TRUE,col="blue",density=30,axes=FALSE)
barplot(xa/sum(xa),add=TRUE,col="orange",density=30,axes=FALSE,angle=225)
#barplot(na/sum(na),add=TRUE,col="black",density=20,axes=FALSE,angle=90)
dev.off()
library(bioimagetools)
setwd("/home/schmid/projects/marion/C2C12Xpaint")
files<-sample(list.files("class7"))
file<-files[1]
class<-readTIF(paste0("class7/",file))
class<-round(class*7)
class<-round(class*7)
n1<-as.vector(c(class[1:(x-1),,],class[2:x,,],class[,1:(x-1),],class[,2:x,]))
x<-dim(class)[1]
y<-dim(class)[2]
n1<-as.vector(c(class[1:(x-1),,],class[2:x,,],class[,1:(x-1),],class[,2:x,]))
n2<-as.vector(c(class[2:x,,],class[1:(x-1),,],class[,2:x,],class[,1:(x-1),]))
table(n1,n2)
temp<-.Last.value
dim(temp)
temp<-temp[-1,-1]
image(temp)
plot(temp[1,])
plot(temp[2,])
plot(temp[3,])
plot(temp[4,])
plot(temp[5,])
plot(temp[6,])
plot(temp[7,])
remove(n1,n2)
gc()
par(mfrow=c(4,2))
for(i in 1:7)
{
plot(temp[i,],type="l",main=paste0("class ",i))
}
plot(temp[i,],type="l",main=paste0("class ",i))
plot(temp[i,],type="l",main=paste0("class ",i)),axes=FALSE)
plot(temp[i,],type="l",main=paste0("class ",i),axes=FALSE)
plot(temp[i,],type="l",main=paste0("class ",i),axes=FALSE,ylab="",xlab="")
axis(1)
box()
file
file<-files[5]
file
class<-readTIF(paste0("class7/",file))
class<-round(class*7)
x<-dim(class)[1]
y<-dim(class)[2]
n1<-as.vector(c(class[1:(x-1),,],class[2:x,,],class[,1:(x-1),],class[,2:x,]))
n2<-as.vector(c(class[2:x,,],class[1:(x-1),,],class[,2:x,],class[,1:(x-1),]))
temp<-table(n1,n2)
remove(n1,n2)
gc()
temp<-temp[-1,-1]
pdf("class_neighbours.pdf")
par(mfrow=c(4,2))
for(i in 1:7)
{
plot(temp[i,],type="l",main=paste0("class ",i),axes=FALSE,ylab="",xlab="")
axis(1)
box()
}
dev.off()
library(bioimagetools)
for (file in files)
{
try({
mask<-readTIF(paste0("dapimask/",file))
xmask<-readTIF(paste0("x_mask/",file))
xmask<-round(xmask)
xmask<-bwlabel3d(xmask,silent=TRUE)
class<-readTIF(paste0("class7/",file))
class<-round(class*7)
png(paste0("x_results/",file,".png"))
par(pty="s")
image.plot(apply(class,1:2,mean),col=grey(seq(0,1,by=.01)))
xm<-apply(xmask*mask,1:2,max)
image.plot(ifelse(xm==0,NA,xm),add=TRUE)
dev.off()
})
}
files<-sample(list.files("blue"))
for (file in files)
{
try({
mask<-readTIF(paste0("dapimask/",file))
xmask<-readTIF(paste0("x_mask/",file))
xmask<-round(xmask)
xmask<-bwlabel3d(xmask,silent=TRUE)
class<-readTIF(paste0("class7/",file))
class<-round(class*7)
png(paste0("x_results/",file,".png"))
par(pty="s")
image.plot(apply(class,1:2,mean),col=grey(seq(0,1,by=.01)))
xm<-apply(xmask*mask,1:2,max)
image.plot(ifelse(xm==0,NA,xm),add=TRUE)
dev.off()
})
}
files
setwd("/home/schmid/projects/marion/C2C12Xpaint")
files<-sample(list.files("blue"))
for (file in files)
{
try({
mask<-readTIF(paste0("dapimask/",file))
xmask<-readTIF(paste0("x_mask/",file))
xmask<-round(xmask)
xmask<-bwlabel3d(xmask,silent=TRUE)
class<-readTIF(paste0("class7/",file))
class<-round(class*7)
png(paste0("x_results/",file,".png"))
par(pty="s")
image.plot(apply(class,1:2,mean),col=grey(seq(0,1,by=.01)))
xm<-apply(xmask*mask,1:2,max)
image.plot(ifelse(xm==0,NA,xm),add=TRUE)
dev.off()
})
}
?save
load("~/projects/marion/felix/test-micron.Rdata")
library(nucim)
classes.red<-table.points(classes,points.red,mic=FALSE,mask=mask)
dim(classes)
range(classes)
summary(points.red)
dim(color)
dim(points.red)
points<-apply(color,1,.tp,classes,mask)
.tp<-function(point,classes,mask)
{
X<-round(point[1])
Y<-round(point[2])
Z<-round(point[3])
#  print(c(X,Y,Z,dim(mask)))
if(mask[X,Y,Z])return(classes[X,Y,Z])
else{return(NA)}
}
points<-apply(color,1,.tp,classes,mask)
color<-points.red
points<-apply(color,1,.tp,classes,mask)
dim(color)
.tp(color[1,],classses,mask)
.tp(as.vector(color[1,]),classses,mask)
class(color)
color<-as.array(points.red)
color<-as.matrix(points.red)
points<-apply(color,1,.tp,classes,mask)
.tp(as.vector(color[1,]),classses,mask)
color[1,]
range(color)
load("~/projects/marion/felix/test-px.Rdata")
color<-as.matrix(points.red)
range(color)
range<-round(color)
.tp(as.vector(color[1,]),classses,mask)
color[1,]
color<-round(color)
color[1,]
.tp(as.vector(color[1,]),classses,mask)
mask[X,Y,Z]
points<-apply(color,1,.tp,classes,mask)
dim(mask)
sum(mask)
range8mask
range(mask)
.tp<-function(point,classes,mask)
{
X<-round(point[1])
Y<-round(point[2])
Z<-round(point[3])
#  print(c(X,Y,Z,dim(mask)))
if(mask[X,Y,Z]==1)return(classes[X,Y,Z])
else{return(NA)}
}
points<-apply(color,1,.tp,classes,mask)
dim(mask)
dim(classes)
range(points.red)
summary(points.green)
summary(points.red)
?abind
?aperm
color<-aperm(points.red,c(2,1,3))
color<-aperm(points.red,perm=c(2,1,3))
color<-points.red[c(2,1,3),]
points<-apply(color,1,.tp,classes,mask)
load("~/projects/marion/felix/test-px.Rdata")
library(nucim)
classes.red<-table.points(classes,points.red,mic=FALSE,mask=mask)
barplot(classes.red)
points<-points.red[c(2,1,3),]
classes.red<-table.points(classes,points.red,mic=FALSE,mask=mask)
barplot(classes.red)
dim(mask)
dim(classes)
summary(points)
summary(points.red)
dim(points.red)
points<-points.red[,c(2,1,3),]
points<-points.red[,c(2,1,3)]
summary(points)
classes.red<-table.points(classes,points,mic=FALSE,mask=mask)
barplot(classes.red)
points<-points.green[,c(2,1,3)]
classes.red<-table.points(classes,points,mic=FALSE,mask=mask)
barplot(classes.red)
image(mask[,,15])
apply(mask,3,sum)
image(mask[,,30])
plot(points[,1],points[,2],pch=19,cex=.3)
image(mask[,,30])
plot(points[,1],points[,2],pch=19,cex=.3)
image(mask[,,30])
